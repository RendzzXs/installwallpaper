#!/bin/bash

# -------------------------------
# RENDZZ OFFICIAL - GLASS EDITION V3
# -------------------------------
PTERO_DIR="/var/www/pterodactyl"
TARGET_FILE="$PTERO_DIR/resources/views/templates/base/core.blade.php"
FOOTER_FILE="$PTERO_DIR/resources/views/templates/base/footer.blade.php"
BACKUP_FILE="$PTERO_DIR/core.backup"
WALLPAPER_DIR="$PTERO_DIR/public/rendzz"
WALLPAPER_FILE="$WALLPAPER_DIR/bg.jpg"

# Warna
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'

# -------------------------------
# FUNCTION: HEADER
# -------------------------------
show_header() {
    clear
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘                                                        â•‘${NC}"
    echo -e "${CYAN}â•‘${WHITE}              ğŸ”¥ RENDZZ GLASS EDITION V3 ğŸ”¥          ${CYAN}â•‘${NC}"
    echo -e "${CYAN}â•‘${WHITE}                  Premium Panel Effect              ${CYAN}â•‘${NC}"
    echo -e "${CYAN}â•‘                                                        â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

# -------------------------------
# FUNCTION: HAPUS WALLPAPER
# -------------------------------
uninstall_wallpaper() {
    show_header
    echo -e "${YELLOW}ğŸ—‘ï¸  Menghapus wallpaper & efek glass...${NC}\n"
    
    # Hapus folder wallpaper
    if [ -d "$WALLPAPER_DIR" ]; then
        rm -rf "$WALLPAPER_DIR"
        echo -e "${GREEN}âœ… Folder wallpaper dihapus${NC}"
    fi
    
    # Kembalikan core.blade.php ke default
    cat > "$TARGET_FILE" << 'EOF'
@extends('templates/wrapper', [
    'css' => ['body' => 'bg-neutral-800'],
])

@section('container')
    <div id="modal-portal"></div>
    <div id="app"></div>
@endsection
EOF
    
    # Kembalikan footer ke default
    if [ -f "$FOOTER_FILE" ]; then
        sed -i 's/Rendzz OfficialÂ®/PterodactylÂ®/g' "$FOOTER_FILE"
        sed -i 's/Â© 2025 - 2026/Â© 2015 - 2026/g' "$FOOTER_FILE"
    fi
    
    # Clear cache
    cd "$PTERO_DIR" 2>/dev/null
    php artisan view:clear
    php artisan cache:clear
    
    echo -e "\n${GREEN}âœ… Panel kembali normal 100%!${NC}"
    echo -e "${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
}

# -------------------------------
# FUNCTION: INSTALL WALLPAPER + GLASS
# -------------------------------
install_wallpaper() {
    show_header
    
    # Input URL
    echo -e "${YELLOW}ğŸ“¸ Masukkan URL wallpaper (direct link gambar):${NC}"
    echo -e "${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -n "â¤ "
    read WALLPAPER_URL
    
    # Validasi URL
    if [ -z "$WALLPAPER_URL" ]; then
        echo -e "\n${RED}âŒ URL tidak boleh kosong!${NC}"
        return 1
    fi
    
    if [[ ! "$WALLPAPER_URL" =~ ^https?:// ]]; then
        echo -e "\n${RED}âŒ URL harus diawali http:// atau https://${NC}"
        return 1
    fi
    
    echo -e "\n${GREEN}âœ… URL diterima${NC}"
    echo -e "${BLUE}ğŸ“ $WALLPAPER_URL${NC}"
    echo ""
    
    # Backup
    cp "$TARGET_FILE" "$BACKUP_FILE" 2>/dev/null
    
    # Download wallpaper
    echo -e "${YELLOW}ğŸ“¥ Downloading wallpaper...${NC}"
    mkdir -p "$WALLPAPER_DIR"
    curl -L "$WALLPAPER_URL" -o "$WALLPAPER_FILE" --progress-bar
    
    if [ ! -f "$WALLPAPER_FILE" ]; then
        echo -e "\n${RED}âŒ Gagal download wallpaper!${NC}"
        return 1
    fi
    
    chmod 644 "$WALLPAPER_FILE"
    chown -R www-data:www-data "$WALLPAPER_DIR" 2>/dev/null || \
    chown -R nginx:nginx "$WALLPAPER_DIR" 2>/dev/null || \
    chown -R apache:apache "$WALLPAPER_DIR" 2>/dev/null
    
    echo -e "${GREEN}âœ… Wallpaper tersimpan${NC}\n"
    
    # -------------------------------
    # INJECT CORE BLADE - GLASS EDITION
    # -------------------------------
    echo -e "${YELLOW}ğŸ¨ Menginjeksi efek glass premium...${NC}"
    
    cat > "$TARGET_FILE" << 'EOF'
@extends('templates/wrapper', [
    'css' => ['body' => 'bg-neutral-800'],
])

@section('container')
    <div id="modal-portal"></div>
    <div id="app"></div>

    <style>
        /* ======================================= */
        /*   RENDZZ GLASS EDITION V3 - PREMIUM    */
        /* ======================================= */

        /* BACKGROUND DENGAN EFEK BLUR */
        body {
            background: url('/rendzz/bg.jpg') no-repeat center center fixed !important;
            background-size: cover !important;
            position: relative;
        }

        /* LAPISAN OVERLAY GRADIENT */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, 
                rgba(0, 0, 0, 0.2) 0%, 
                rgba(20, 30, 50, 0.5) 100%
            );
            backdrop-filter: blur(8px);
            pointer-events: none;
            z-index: 1;
        }

        /* WATERMARK PREMIUM */
        body::before {
            content: "RENDZZ OFFICIAL";
            position: fixed;
            bottom: 25px;
            right: 35px;
            color: rgba(255, 255, 255, 0.15);
            font-size: 16px;
            font-family: 'Poppins', 'Segoe UI', monospace;
            font-weight: 700;
            letter-spacing: 8px;
            z-index: 9999;
            text-transform: uppercase;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
            opacity: 0.6;
            transform: rotate(0deg);
        }

        /* SEMUA KONTEN DI ATAS OVERLAY */
        #app, #modal-portal, .content-wrapper, .main-sidebar,
        .card, .navbar, .footer, .modal-content, .dropdown-menu {
            position: relative;
            z-index: 2;
        }

        /* ========== GLASSMORPHISM SIDEBAR ========== */
        .main-sidebar {
            background: rgba(18, 22, 35, 0.65) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(16px) saturate(180%) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 8px 0 32px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease;
        }

        .main-sidebar:hover {
            background: rgba(25, 30, 45, 0.75) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* ========== NAVBAR GLASS ========== */
        .main-header {
            background: rgba(25, 30, 40, 0.6) !important;
            backdrop-filter: blur(14px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(14px) saturate(180%) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15) !important;
        }

        /* ========== CARD GLASS ELEGAN ========== */
        .card {
            background: rgba(255, 255, 255, 0.75) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(16px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.25) !important;
            border-radius: 16px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        }

        .card:hover {
            transform: translateY(-6px);
            background: rgba(255, 255, 255, 0.85) !important;
            border: 1px solid rgba(255, 255, 255, 0.4) !important;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2) !important;
        }

        /* ========== DARK MODE CARD ========== */
        .dark-mode .card {
            background: rgba(20, 25, 35, 0.7) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
        }

        .dark-mode .card:hover {
            background: rgba(30, 35, 45, 0.8) !important;
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
        }

        /* ========== DARK MODE SIDEBAR ========== */
        .dark-mode .main-sidebar {
            background: rgba(10, 12, 20, 0.75) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        /* ========== DARK MODE NAVBAR ========== */
        .dark-mode .main-header {
            background: rgba(15, 17, 25, 0.7) !important;
            backdrop-filter: blur(14px) saturate(180%) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03) !important;
        }

        /* ========== BUTTON PREMIUM ========== */
        .btn {
            border-radius: 10px !important;
            transition: all 0.2s ease !important;
            font-weight: 500 !important;
            letter-spacing: 0.3px !important;
        }

        .btn-primary {
            background: linear-gradient(145deg, #4776E6, #8E54E9) !important;
            border: none !important;
            box-shadow: 0 6px 20px rgba(71, 118, 230, 0.3) !important;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(71, 118, 230, 0.45) !important;
        }

        /* ========== MODAL GLASS ========== */
        .modal-content {
            background: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 24px !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2) !important;
        }

        .dark-mode .modal-content {
            background: rgba(20, 25, 35, 0.85) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
        }

        /* ========== DROPDOWN GLASS ========== */
        .dropdown-menu {
            background: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 14px !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15) !important;
        }

        .dark-mode .dropdown-menu {
            background: rgba(25, 30, 40, 0.85) !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        /* ========== TABLE GLASS ========== */
        .table {
            background: rgba(255, 255, 255, 0.6) !important;
            backdrop-filter: blur(8px) !important;
            border-radius: 12px !important;
        }

        .dark-mode .table {
            background: rgba(20, 25, 35, 0.6) !important;
        }

        /* ========== SCROLLBAR CUSTOM ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(4px);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* ========== ANIMASI HALUS ========== */
        .card, .btn, .nav-item, .dropdown, .modal-content {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }
    </style>
@endsection
EOF

    # -------------------------------
    # GANTI COPYRIGHT FOOTER
    # -------------------------------
    if [ -f "$FOOTER_FILE" ]; then
        sed -i 's/PterodactylÂ®/Rendzz OfficialÂ®/g' "$FOOTER_FILE"
        sed -i 's/Â© [0-9]\{4\} - [0-9]\{4\}/Â© 2025 - 2026/g' "$FOOTER_FILE"
    fi
    
    # -------------------------------
    # GANTI TITLE PANEL
    # -------------------------------
    sed -i 's/<title>.*<\/title>/<title>âœ¨ Rendzz Glass Edition âœ¨<\/title>/g' "$PTERO_DIR/resources/views/layouts/admin.blade.php" 2>/dev/null
    sed -i 's/<title>.*<\/title>/<title>âœ¨ Rendzz Glass Edition âœ¨<\/title>/g' "$PTERO_DIR/resources/views/layouts/auth.blade.php" 2>/dev/null
    
    # -------------------------------
    # CLEAR CACHE
    # -------------------------------
    cd "$PTERO_DIR" 2>/dev/null
    php artisan view:clear
    php artisan cache:clear
    
    # -------------------------------
    # SUCCESS MESSAGE
    # -------------------------------
    echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${GREEN}â•‘           âœ… INSTALLASI PREMIUM BERHASIL! âœ…          â•‘${NC}"
    echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${CYAN}ğŸ–¼ï¸  Wallpaper  : ${NC}$WALLPAPER_URL"
    echo -e "${PURPLE}ğŸ¨ Efek Glass  : Sidebar | Card | Navbar | Modal${NC}"
    echo -e "${BLUE}ğŸ’§ Watermark   : Rendzz Official${NC}"
    echo -e "${YELLOW}Â©ï¸  Footer      : Rendzz OfficialÂ® 2025-2026${NC}"
    echo -e "${GREEN}ğŸ“Œ Title       : âœ¨ Rendzz Glass Edition âœ¨${NC}"
    echo -e "${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}ğŸš€ Refresh browser (CTRL+SHIFT+R) untuk lihat hasil!${NC}"
}

# -------------------------------
# MAIN MENU
# -------------------------------
while true; do
    show_header
    echo -e "${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${WHITE}â•‘           ğŸ”¥ PILIH MENU ğŸ”¥               â•‘${NC}"
    echo -e "${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${WHITE}â•‘                                          â•‘${NC}"
    echo -e "${WHITE}â•‘  ${RED}[1]${NC} ğŸ—‘ï¸  HAPUS Wallpaper & Efek Glass   ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[2]${NC} âœ¨ INSTALL Wallpaper + Glass     ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${BLUE}[x]${NC} âŒ KELUAR                       ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘                                          â•‘${NC}"
    echo -e "${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -ne "${YELLOW}â¤ Pilih menu [1/2/x]: ${NC}"
    read MENU
    
    case $MENU in
        1)
            uninstall_wallpaper
            echo ""
            echo -ne "${CYAN}Tekan Enter untuk kembali ke menu...${NC}"
            read
            ;;
        2)
            install_wallpaper
            echo ""
            echo -ne "${CYAN}Tekan Enter untuk kembali ke menu...${NC}"
            read
            ;;
        x)
            show_header
            echo -e "${GREEN}âœ¨ Terima kasih telah menggunakan Rendzz Glass Edition!${NC}"
            echo -e "${CYAN}ğŸ“± Telegram: @lynnn046${NC}"
            echo ""
            exit 0
            ;;
        *)
            echo -e "${RED}Pilihan tidak valid!${NC}"
            sleep 1
            ;;
    esac
done
