#!/bin/bash

# -------------------------------
# RENDZZ UNIQUE EDITION - BUKAN KOTAK BIASA!
# -------------------------------
PTERO_DIR="/var/www/pterodactyl"
TARGET_FILE="$PTERO_DIR/resources/views/templates/base/core.blade.php"
FOOTER_FILE="$PTERO_DIR/resources/views/templates/base/footer.blade.php"
SERVER_FILE="$PTERO_DIR/resources/views/templates/base/server.blade.php"
DASHBOARD_FILE="$PTERO_DIR/resources/scripts/components/dashboard/DashboardContainer.tsx"
BACKUP_FILE="$PTERO_DIR/core.backup"
WALLPAPER_DIR="$PTERO_DIR/public/rendzz"
WALLPAPER_FILE="$WALLPAPER_DIR/bg.jpg"

# Warna
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'

# -------------------------------
# FUNCTION: HEADER
# -------------------------------
show_header() {
    clear
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘                                                        â•‘${NC}"
    echo -e "${CYAN}â•‘${WHITE}          ğŸ”¥ RENDZZ UNIQUE  ğŸ”¥              ${CYAN}â•‘${NC}"
    echo -e "${CYAN}â•‘${WHITE}                      !                  ${CYAN}â•‘${NC}"
    echo -e "${CYAN}â•‘                                                        â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

# -------------------------------
# FUNCTION: HAPUS WALLPAPER
# -------------------------------
uninstall_wallpaper() {
    show_header
    echo -e "${YELLOW}ğŸ—‘ï¸  Menghapus custom design...${NC}\n"
    
    # Hapus folder wallpaper
    if [ -d "$WALLPAPER_DIR" ]; then
        rm -rf "$WALLPAPER_DIR"
        echo -e "${GREEN}âœ… Folder wallpaper dihapus${NC}"
    fi
    
    # Kembalikan core.blade.php ke default
    cat > "$TARGET_FILE" << 'EOF'
@extends('templates/wrapper', [
    'css' => ['body' => 'bg-neutral-800'],
])

@section('container')
    <div id="modal-portal"></div>
    <div id="app"></div>
@endsection
EOF
    
    # Kembalikan footer ke default
    if [ -f "$FOOTER_FILE" ]; then
        sed -i 's/Rendzz OfficialÂ®/PterodactylÂ®/g' "$FOOTER_FILE"
        sed -i 's/Â© 2025 - 2026/Â© 2015 - 2026/g' "$FOOTER_FILE"
    fi
    
    # Clear cache
    cd "$PTERO_DIR" 2>/dev/null
    php artisan view:clear
    php artisan cache:clear
    
    echo -e "\n${GREEN}âœ… Panel kembali normal!${NC}"
}

# -------------------------------
# FUNCTION: INSTALL WALLPAPER + UNIQUE DESIGN
# -------------------------------
install_wallpaper() {
    show_header
    
    # Input URL
    echo -e "${YELLOW}ğŸ“¸ Masukkan URL wallpaper:${NC}"
    echo -n "â¤ "
    read WALLPAPER_URL
    
    # Validasi URL
    if [ -z "$WALLPAPER_URL" ]; then
        echo -e "\n${RED}âŒ URL tidak boleh kosong!${NC}"
        return 1
    fi
    
    # Backup
    cp "$TARGET_FILE" "$BACKUP_FILE" 2>/dev/null
    
    # Download wallpaper
    echo -e "\n${YELLOW}ğŸ“¥ Downloading wallpaper...${NC}"
    mkdir -p "$WALLPAPER_DIR"
    curl -L "$WALLPAPER_URL" -o "$WALLPAPER_FILE" --progress-bar
    
    if [ ! -f "$WALLPAPER_FILE" ]; then
        echo -e "\n${RED}âŒ Gagal download wallpaper!${NC}"
        return 1
    fi
    
    chmod 644 "$WALLPAPER_FILE"
    chown -R www-data:www-data "$WALLPAPER_DIR" 2>/dev/null || \
    chown -R nginx:nginx "$WALLPAPER_DIR" 2>/dev/null
    
    echo -e "${GREEN}âœ… Wallpaper tersimpan${NC}\n"
    
    # -------------------------------
    # GANTI COPYRIGHT FOOTER - FIX BANGET!
    # -------------------------------
    echo -e "${YELLOW}Â©ï¸  Mengganti copyright footer...${NC}"
    
    # Backup dulu
    cp "$FOOTER_FILE" "$FOOTER_FILE.bak" 2>/dev/null
    
    # GANTI LANGSUNG DENGAN SED - PASTI BERUBAH!
    sed -i 's/PterodactylÂ®/Rendzz OfficialÂ®/g' "$FOOTER_FILE"
    sed -i 's/Pterodactyl/Rendzz Official/g' "$FOOTER_FILE"
    sed -i 's/Â© 2015 - 2026/Â© 2025 - 2026/g' "$FOOTER_FILE"
    sed -i 's/Â© [0-9]\{4\} - [0-9]\{4\}/Â© 2025 - 2026/g' "$FOOTER_FILE"
    
    echo -e "${GREEN}âœ… Footer: Rendzz OfficialÂ® Â© 2025 - 2026${NC}\n"
    
    # -------------------------------
    # INJECT CORE BLADE - UNIQUE DESIGN
    # -------------------------------
    echo -e "${YELLOW}ğŸ¨ Menginjeksi unique design...${NC}"
    
    cat > "$TARGET_FILE" << 'EOF'
@extends('templates/wrapper', [
    'css' => ['body' => 'bg-neutral-800'],
])

@section('container')
    <div id="modal-portal"></div>
    <div id="app"></div>

    <style>
        /* ======================================= */
        /*   RENDZZ UNIQUE EDITION                */
        /*   Bukan Kotak Biasa!                  */
        /* ======================================= */

        /* BACKGROUND */
        body {
            background: url('/rendzz/bg.jpg') no-repeat center center fixed !important;
            background-size: cover !important;
        }

        /* OVERLAY TIPIS - NO BLUR BERLEBIHAN */
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            pointer-events: none;
            z-index: 1;
        }

        #app, .content-wrapper {
            position: relative;
            z-index: 2;
        }

        /* ======================================= */
        /*   SERVER CARD - BUKAN KOTAK BIASA!     */
        /* ======================================= */
        
        /* ANIMASI MASUK DARI KIRI */
        @keyframes slideInLeft {
            0% {
                opacity: 0;
                transform: translateX(-50px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* CARD SERVER - BENTUK HEXAGON! */
        .card {
            background: rgba(255, 255, 255, 0.9) !important;
            border: none !important;
            border-radius: 20px 8px 20px 8px !important;  /* UNIK! Bukan kotak biasa */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15) !important;
            transition: all 0.3s ease !important;
            animation: slideInLeft 0.6s ease-out !important;
            position: relative;
            overflow: hidden;
        }

        /* GARIS DEKORATIF */
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(180deg, #ff6b6b, #4ecdc4);
            border-radius: 20px 0 0 8px;
        }

        /* HOVER EFEK - NAIK & BAYANGAN */
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25) !important;
            background: white !important;
        }

        /* CARD BODY */
        .card-body {
            padding: 1.5rem !important;
        }

        /* TITLE SERVER */
        .card-title {
            font-weight: 700 !important;
            color: #2d3748 !important;
            border-bottom: 2px dashed #4ecdc4;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        /* ======================================= */
        /*   SIDEBAR - MODERN                        */
        /* ======================================= */
        .main-sidebar {
            background: rgba(26, 32, 44, 0.85) !important;
            border-right: none !important;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.2) !important;
        }

        .nav-link {
            border-radius: 12px !important;
            margin: 5px 15px !important;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            transform: translateX(5px);
        }

        /* ======================================= */
        /*   NAVBAR - CLEAN                          */
        /* ======================================= */
        .main-header {
            background: rgba(255, 255, 255, 0.85) !important;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1) !important;
            border-bottom: none !important;
        }

        .dark-mode .main-header {
            background: rgba(26, 32, 44, 0.85) !important;
        }

        /* ======================================= */
        /*   BUTTON - CIRCLE                        */
        /* ======================================= */
        .btn {
            border-radius: 50px !important;  /* BULAT! */
            padding: 8px 20px !important;
            font-weight: 600 !important;
            transition: all 0.2s ease !important;
        }

        .btn-primary {
            background: linear-gradient(145deg, #4ecdc4, #556270) !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3) !important;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4) !important;
        }

        /* ======================================= */
        /*   MODAL - UNIK                          */
        /* ======================================= */
        .modal-content {
            border-radius: 30px 10px 30px 10px !important;  /* UNIK! */
            border: none !important;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3) !important;
        }

        .modal-header {
            border-bottom: 2px dashed #4ecdc4 !important;
            border-radius: 30px 10px 0 0 !important;
        }

        /* ======================================= */
        /*   DARK MODE                             */
        /* ======================================= */
        .dark-mode .card {
            background: rgba(26, 32, 44, 0.85) !important;
            color: white !important;
        }

        .dark-mode .card-title {
            color: white !important;
            border-bottom: 2px dashed #4ecdc4;
        }

        .dark-mode .main-header {
            background: rgba(26, 32, 44, 0.85) !important;
        }

        /* ======================================= */
        /*   WATERMARK MINIMAL                       */
        /* ======================================= */
        body::before {
            content: "RENDZZ";
            position: fixed;
            bottom: 15px;
            right: 25px;
            color: rgba(255, 255, 255, 0.2);
            font-size: 20px;
            font-weight: 800;
            letter-spacing: 10px;
            z-index: 999;
            pointer-events: none;
            text-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
    </style>
@endsection
EOF

    # -------------------------------
    # GANTI TITLE PANEL
    # -------------------------------
    sed -i 's/<title>.*<\/title>/<title>ğŸ”¥ Rendzz Unique Edition ğŸ”¥<\/title>/g' "$PTERO_DIR/resources/views/layouts/admin.blade.php" 2>/dev/null
    sed -i 's/<title>.*<\/title>/<title>ğŸ”¥ Rendzz Unique Edition ğŸ”¥<\/title>/g' "$PTERO_DIR/resources/views/layouts/auth.blade.php" 2>/dev/null
    
    # -------------------------------
    # CLEAR CACHE
    # -------------------------------
    cd "$PTERO_DIR" 2>/dev/null
    php artisan view:clear
    php artisan cache:clear
    php artisan config:clear
    
    # -------------------------------
    # SUCCESS MESSAGE
    # -------------------------------
    echo -e "\n${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${GREEN}â•‘           âœ… INSTALLASI UNIQUE BERHASIL! âœ…          â•‘${NC}"
    echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${CYAN}ğŸ–¼ï¸  Wallpaper   : ${NC}CUSTOM"
    echo -e "${PURPLE}ğŸƒ Server Card  : ${NC}Hexagon style (20px 8px 20px 8px)"
    echo -e "${BLUE}ğŸ¬ Animasi      : ${NC}Slide In Left + Hover naik"
    echo -e "${YELLOW}âšª Button       : ${NC}Bulat (50px radius)"
    echo -e "${GREEN}Â©ï¸  Footer       : ${NC}Rendzz OfficialÂ® Â© 2025-2026"
    echo -e "${WHITE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}ğŸš€ Refresh browser (CTRL+SHIFT+R)!${NC}"
}

# -------------------------------
# MAIN MENU
# -------------------------------
while true; do
    show_header
    echo -e "${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${WHITE}â•‘           ğŸ”¥ PILIH MENU ğŸ”¥               â•‘${NC}"
    echo -e "${WHITE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${WHITE}â•‘                                          â•‘${NC}"
    echo -e "${WHITE}â•‘  ${RED}[1]${NC} ğŸ—‘ï¸  HAPUS - Balik Normal         ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${GREEN}[2]${NC} âœ¨ INSTALL - Unique Edition     ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘  ${BLUE}[x]${NC} âŒ KELUAR                       ${WHITE}â•‘${NC}"
    echo -e "${WHITE}â•‘                                          â•‘${NC}"
    echo -e "${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -ne "${YELLOW}â¤ Pilih menu [1/2/x]: ${NC}"
    read MENU
    
    case $MENU in
        1)
            uninstall_wallpaper
            echo ""
            echo -ne "${CYAN}Tekan Enter untuk kembali...${NC}"
            read
            ;;
        2)
            install_wallpaper
            echo ""
            echo -ne "${CYAN}Tekan Enter untuk kembali...${NC}"
            read
            ;;
        x)
            echo -e "\n${GREEN}âœ¨ Thanks for using Rendzz Unique Edition!${NC}"
            echo -e "${CYAN}ğŸ“± Telegram: @lynnn046${NC}\n"
            exit 0
            ;;
        *)
            echo -e "${RED}Pilihan tidak valid!${NC}"
            sleep 1
            ;;
    esac
done

